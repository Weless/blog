{"remainingRequest":"/Users/joey/joey/go_project/blog/frontend/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/joey/joey/go_project/blog/frontend/src/views/admin/management.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/joey/joey/go_project/blog/frontend/src/views/admin/management.vue","mtime":1592208739108},{"path":"/Users/joey/joey/go_project/blog/frontend/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/joey/joey/go_project/blog/frontend/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/joey/joey/go_project/blog/frontend/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/joey/joey/go_project/blog/frontend/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IGZvcm1hdERhdGUgfSBmcm9tICJAL3V0aWxzL2Zvcm1hdERhdGUiOwppbXBvcnQgeyBHZXRBcnRpY2xlTGlzdCwgQ2hhbmdlU3RhdGUsIFJlbW92ZUFydGljbGUgfSBmcm9tICJAL2FwaS9tYW5hZ2VtZW50IjsKCmV4cG9ydCBkZWZhdWx0IHsKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgdG90YWw6IDAsCiAgICAgIHBhZ2U6IDEsCiAgICAgIHBhZ2VTaXplOiAxMCwKICAgICAgYXJ0aWNsZXM6IFtdLAogICAgICBjb25maXJtUmVtb3ZlOiBmYWxzZSwKICAgICAgcmVtb3ZlSWQ6ICIiCiAgICB9OwogIH0sCiAgY29tcHV0ZWQ6IHsKICAgIGZvcm1hdEFydGljbGVzKCkgewogICAgICByZXR1cm4gdGhpcy5hcnRpY2xlcy5tYXAodmFsID0+IHsKICAgICAgICBsZXQgbGlzdCA9IHt9OwogICAgICAgIGxpc3QuX2lkID0gdmFsLl9pZDsKICAgICAgICBsaXN0LmFydGljbGVUaXRsZSA9IHZhbC50aXRsZTsKICAgICAgICBsaXN0LnRhZ3MgPSB2YWwudGFncy5yZWR1Y2UoKGEsIGIpID0+IGEgKyAiLCIgKyBiKTsKICAgICAgICBsaXN0LmRhdGUgPSBmb3JtYXREYXRlKG5ldyBEYXRlKHZhbC5kYXRlKSwgInl5eXktTU0tZGQgaGg6bW0iKTsKICAgICAgICBsaXN0Lmxhc3REYXRlID0gZm9ybWF0RGF0ZSgKICAgICAgICAgIG5ldyBEYXRlKHZhbC5sYXN0RGF0ZSB8fCBsaXN0LmRhdGUpLAogICAgICAgICAgInl5eXktTU0tZGQgaGg6bW0iCiAgICAgICAgKTsKICAgICAgICBsaXN0LnJlYWRDb3VudCA9IHZhbC5yZWFkQ291bnQ7CiAgICAgICAgbGlzdC50eXBlID0gdmFsLnR5cGUgPT09IDEgPyAi56eB5a+GIiA6ICLlhazlvIAiOwogICAgICAgIHJldHVybiBsaXN0OwogICAgICB9KTsKICAgIH0KICB9LAogIGNyZWF0ZWQoKSB7CiAgICB0aGlzLmxvYWRBcnRpY2xlcygpOwogIH0sCiAgbWV0aG9kczogewogICAgbG9hZEFydGljbGVzKCkgewogICAgICBsZXQgcGFyYW0gPSB7CiAgICAgICAgcGFnZTogdGhpcy5wYWdlLAogICAgICAgIHBhZ2VTaXplOiB0aGlzLnBhZ2VTaXplCiAgICAgIH07CiAgICAgIEdldEFydGljbGVMaXN0KHBhcmFtKS50aGVuKHJlcyA9PiB7CiAgICAgICAgbGV0IGRhdGEgPSByZXMuZGF0YTsKICAgICAgICB0aGlzLiRuZXh0VGljayhmdW5jdGlvbigpIHsKICAgICAgICAgIHRoaXMudG90YWwgPSBkYXRhLnJlc0RhdGEudG90YWw7CiAgICAgICAgICB0aGlzLmFydGljbGVzID0gZGF0YS5yZXNEYXRhLmxpc3Q7CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfSwKICAgIGhhbmRsZU1vZGlmeShpbmRleCkgewogICAgICBsZXQgaWQgPSB0aGlzLmFydGljbGVzW2luZGV4XS5faWQ7CiAgICAgIHRoaXMuJHJvdXRlci5wdXNoKHsgcGF0aDogIm1vZGlmeUFydGljbGUiLCBxdWVyeTogeyBfaWQ6IGlkIH0gfSk7CiAgICB9LAogICAgaGFuZGxlVHlwZUNoYW5nZShpKSB7CiAgICAgIGxldCBpZCA9IHRoaXMuYXJ0aWNsZXNbaV0uX2lkOwogICAgICBsZXQgbmV3RGF0YSA9IHRoaXMuYXJ0aWNsZXNbaV0udHlwZSA9PT0gMSA/IHsgdHlwZTogMCB9IDogeyB0eXBlOiAxIH07CiAgICAgIENoYW5nZVN0YXRlKHsgX2lkOiBpZCwgbmV3RGF0YTogbmV3RGF0YSB9KQogICAgICAgIC50aGVuKCgpID0+IHsKICAgICAgICAgIHRoaXMuJG1lc3NhZ2Uuc3VjY2Vzcygi5YiH5o2i5oiQ5YqfISIpOwogICAgICAgICAgdGhpcy5hcnRpY2xlc1tpXS50eXBlID0gMSBeIHRoaXMuYXJ0aWNsZXNbaV0udHlwZTsKICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoKSA9PiB7fSk7CiAgICB9LAogICAgaGFuZGxlUmVtb3ZlKGluZGV4KSB7CiAgICAgIHRoaXMuY29uZmlybVJlbW92ZSA9IHRydWU7CiAgICAgIHRoaXMucmVtb3ZlSWQgPSB0aGlzLmFydGljbGVzW2luZGV4XS5faWQ7CiAgICB9LAogICAgZGlhbG9nQ2xpY2tPaygpIHsKICAgICAgdGhpcy5jb25maXJtUmVtb3ZlID0gZmFsc2U7CiAgICAgIFJlbW92ZUFydGljbGUoeyBfaWQ6IHRoaXMucmVtb3ZlSWQgfSkKICAgICAgICAudGhlbigoKSA9PiB7CiAgICAgICAgICB0aGlzLiRtZXNzYWdlLnN1Y2Nlc3MoIuWIoOmZpOaIkOWKnyEiKTsKICAgICAgICAgIHRoaXMubG9hZEFydGljbGVzKCk7CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKCkgPT4ge30pOwogICAgfSwKICAgIGhhbmRsZUN1cnJlbnRDaGFuZ2UodmFsKSB7CiAgICAgIHRoaXMucGFnZSA9IHZhbDsKICAgICAgdGhpcy5sb2FkQXJ0aWNsZXMoKTsKICAgIH0KICB9Cn07Cg=="},{"version":3,"sources":["management.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA0FA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"management.vue","sourceRoot":"src/views/admin","sourcesContent":["<template>\n  <div class=\"management\">\n    <el-table :data=\"formatArticles\" border>\n      <el-table-column\n        align=\"center\"\n        fixed\n        prop=\"articleTitle\"\n        label=\"标题\"\n        min-width=\"200\"\n      ></el-table-column>\n      <el-table-column\n        align=\"center\"\n        prop=\"tags\"\n        label=\"标签\"\n        min-width=\"100\"\n      ></el-table-column>\n      <el-table-column\n        align=\"center\"\n        prop=\"date\"\n        label=\"创建时间\"\n        min-width=\"120\"\n      ></el-table-column>\n      <el-table-column\n        align=\"center\"\n        prop=\"lastDate\"\n        label=\"最后编辑时间\"\n        min-width=\"120\"\n      ></el-table-column>\n      <el-table-column\n        align=\"center\"\n        prop=\"readCount\"\n        label=\"阅读量\"\n        min-width=\"80\"\n      ></el-table-column>\n      <el-table-column\n        align=\"center\"\n        prop=\"type\"\n        label=\"类型\"\n        min-width=\"80\"\n      ></el-table-column>\n      <el-table-column\n        align=\"center\"\n        fixed=\"right\"\n        label=\"编辑\"\n        min-width=\"200\"\n      >\n        <template slot-scope=\"scope\">\n          <el-button\n            type=\"primary\"\n            size=\"small\"\n            @click=\"handleModify(scope.$index)\"\n            >编辑</el-button\n          >\n          <el-button\n            type=\"primary\"\n            size=\"small\"\n            @click=\"handleTypeChange(scope.$index)\"\n            >切换</el-button\n          >\n          <el-button\n            type=\"error\"\n            size=\"small\"\n            @click=\"handleRemove(scope.$index)\"\n            >删除</el-button\n          >\n        </template>\n      </el-table-column>\n    </el-table>\n    <div class=\"page\">\n      <el-pagination\n        background\n        prev-text=\"上一页\"\n        next-text=\"下一页\"\n        layout=\"prev, pager, next\"\n        :total=\"total\"\n        :page-size=\"pageSize\"\n        @current-change=\"handleCurrentChange\"\n      ></el-pagination>\n    </div>\n    <el-dialog title=\"提示\" :visible.sync=\"confirmRemove\" width=\"30%\">\n      <span>确定删除吗？</span>\n      <span slot=\"footer\" class=\"dialog-footer\">\n        <el-button @click=\"confirmRemove = false\">取 消</el-button>\n        <el-button type=\"primary\" @click=\"dialogClickOk\">确 定</el-button>\n      </span>\n    </el-dialog>\n  </div>\n</template>\n\n<script>\nimport { formatDate } from \"@/utils/formatDate\";\nimport { GetArticleList, ChangeState, RemoveArticle } from \"@/api/management\";\n\nexport default {\n  data() {\n    return {\n      total: 0,\n      page: 1,\n      pageSize: 10,\n      articles: [],\n      confirmRemove: false,\n      removeId: \"\"\n    };\n  },\n  computed: {\n    formatArticles() {\n      return this.articles.map(val => {\n        let list = {};\n        list._id = val._id;\n        list.articleTitle = val.title;\n        list.tags = val.tags.reduce((a, b) => a + \",\" + b);\n        list.date = formatDate(new Date(val.date), \"yyyy-MM-dd hh:mm\");\n        list.lastDate = formatDate(\n          new Date(val.lastDate || list.date),\n          \"yyyy-MM-dd hh:mm\"\n        );\n        list.readCount = val.readCount;\n        list.type = val.type === 1 ? \"私密\" : \"公开\";\n        return list;\n      });\n    }\n  },\n  created() {\n    this.loadArticles();\n  },\n  methods: {\n    loadArticles() {\n      let param = {\n        page: this.page,\n        pageSize: this.pageSize\n      };\n      GetArticleList(param).then(res => {\n        let data = res.data;\n        this.$nextTick(function() {\n          this.total = data.resData.total;\n          this.articles = data.resData.list;\n        });\n      });\n    },\n    handleModify(index) {\n      let id = this.articles[index]._id;\n      this.$router.push({ path: \"modifyArticle\", query: { _id: id } });\n    },\n    handleTypeChange(i) {\n      let id = this.articles[i]._id;\n      let newData = this.articles[i].type === 1 ? { type: 0 } : { type: 1 };\n      ChangeState({ _id: id, newData: newData })\n        .then(() => {\n          this.$message.success(\"切换成功!\");\n          this.articles[i].type = 1 ^ this.articles[i].type;\n        })\n        .catch(() => {});\n    },\n    handleRemove(index) {\n      this.confirmRemove = true;\n      this.removeId = this.articles[index]._id;\n    },\n    dialogClickOk() {\n      this.confirmRemove = false;\n      RemoveArticle({ _id: this.removeId })\n        .then(() => {\n          this.$message.success(\"删除成功!\");\n          this.loadArticles();\n        })\n        .catch(() => {});\n    },\n    handleCurrentChange(val) {\n      this.page = val;\n      this.loadArticles();\n    }\n  }\n};\n</script>\n\n<style lang=\"scss\" scoped>\n.management {\n  padding: 60px 20px;\n  margin: 0 auto;\n  max-width: 1264px;\n  .page {\n    margin-top: 20px;\n  }\n  .btn {\n    margin: 6px 0;\n  }\n}\n</style>\n"]}]}